# FarmFresh Connect – Database (automatic save)

The app **automatically saves** seller registration and products to the database. You do not need to run any extra steps for this.

## When does data get saved?

### 1. Seller registration

When a seller completes registration (either from **Sell** or from **Farmer Register**):

- **`farmers`** – One row is created with:
  - `user_id`, `full_name`, `address`, `aadhar_number`, `contact_number`
  - `farmer_display_id` (e.g. FRM000001) is generated by the database
- **`user_roles`** – One row is created/updated with:
  - `user_id`, `role = 'farmer'`

So: **registering as a seller = automatic insert into `farmers` and `user_roles`.**

### 2. Adding a product

When a seller adds a product (on Farmer Register step 2 or “Add Product” from the dashboard):

- **`products`** – One row is created with:
  - `farmer_id`, `name`, `category`, `description`, `price`, `quantity`, `unit`
  - `validity_days`, `expires_at`, `is_negotiable`, `features`
  - `grade`, `moisture_content`, `purity`, `origin`, `harvest_date` (if provided)

So: **adding a product on the website = automatic insert into `products`.**

No manual DB steps are required for this; it happens when the user submits the form.

## Setting up the database (Supabase)

If you are creating a **new** Supabase project and need the tables and policies:

1. Open your Supabase project → **SQL Editor**.
2. Run the script: **`supabase/FULL_DATABASE_SETUP.sql`** (copy its contents into the editor and run).

That script creates (if they don’t exist):

- `app_role` enum and `farmer_id_seq` sequence  
- `user_roles`, `profiles`, `farmers`, `products`, `prime_memberships`, `product_feedback`, `farmer_feedback`  
- RLS policies so that:
  - Sellers can create/update their own farmer profile and products.
  - Buyers can view active products and give feedback.

If you already use the existing migrations in `supabase/migrations/`, you can keep using them; `FULL_DATABASE_SETUP.sql` is an alternative for a single full setup.

## Summary

| Action on website              | Table(s) updated        |
|--------------------------------|-------------------------|
| Register as seller (complete)  | `farmers`, `user_roles` |
| Add a product                  | `products`              |

Everything above is done automatically when the user registers as a seller and when they add a product.
